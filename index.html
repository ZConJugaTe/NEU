<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>迷宫游戏</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            height: 100vh;
            background: #f0f0f0;
            margin: 0;
        }
        h1 {
            position: absolute;
            top: 20px; /* 距离页面顶部 20px */
            left: 20px; /* 距离页面左边 20px */
            font-size: 48px;
            margin: 0;
        }
        #description-box {
            position: absolute;
            top: 200px; /* 位于标题下方 */
            left: 20px; /* 和标题对齐 */
            width: 200px;
            background-color: #ffffff;
            border: 1px solid #ccc;
            padding: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* 添加阴影 */
        }

        #maze-container {
            display: grid;
            grid-template-columns: repeat(30, 20px);
            grid-gap: 1px;
            margin-top: 20px; /* 确保迷宫在标题和按钮下方 */
        }
        .cell {
            width: 20px;
            height: 20px;
            background: white;
            border: 1px solid #ccc;
        }
        .wall {
            background: black;
        }
        .player {
            background: red;
        }
        .goal {
            background: green;
        }
        #image {
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
        }
        button {
            padding: 10px 20px;
            font-size: 18px;
        }
    </style>
</head>
<body>

<h1>迷宫游戏</h1>
<div id="description-box">
    <p>游戏说明：使用键盘箭头键控制玩家（红色方块），自动走迷宫功能会沿最短路径走到终点。</p>
</div>


<!-- 自动走迷宫按钮 -->
<button onclick="autoWalk()">自动走迷宫</button>

<!-- 迷宫游戏容器 -->
<div id="maze-container"></div>

<script>
const size = 30;
const maze = [];
const playerPosition = { x: 0, y: 0 };
const goalPosition = { x: size - 2, y: size - 2 }; // 终点位置 (14, 14)
let shortestPath = [];

// 生成可行迷宫
function generateMaze() {
    for (let i = 0; i < size; i++) {
        maze[i] = Array(size).fill(1); // 初始化为全墙
    }
    carvePath(0, 0); // 从起点 (0, 0) 开始挖掘路径
    maze[goalPosition.y][goalPosition.x] = 0; // 终点位置为空
    renderMaze();
    shortestPath = findShortestPath(); // 计算最短路径
}

// 使用深度优先搜索挖掘路径，保证能到达终点
function carvePath(x, y) {
    const directions = [
        { dx: 0, dy: -2 }, // 上
        { dx: 2, dy: 0 },  // 右
        { dx: 0, dy: 2 },  // 下
        { dx: -2, dy: 0 }  // 左
    ];
    directions.sort(() => Math.random() - 0.5); // 随机化方向

    for (const { dx, dy } of directions) {
        const newX = x + dx;
        const newY = y + dy;
        if (newX >= 0 && newX < size && newY >= 0 && newY < size && maze[newY][newX] === 1) {
            maze[y + dy / 2][x + dx / 2] = 0; // 打通墙壁
            maze[newY][newX] = 0; // 设为通路
            carvePath(newX, newY); // 递归
        }
    }
}

// 渲染迷宫
function renderMaze() {
    const mazeElement = document.getElementById('maze-container');
    mazeElement.innerHTML = '';
    for (let i = 0; i < size; i++) {
        for (let j = 0; j < size; j++) {
            const cell = document.createElement('div');
            cell.className = 'cell ' + (maze[i][j] === 1 ? 'wall' : '');
            if (i === playerPosition.y && j === playerPosition.x) {
                cell.classList.add('player');
            }
            if (i === goalPosition.y && j === goalPosition.x) {
                cell.classList.add('goal');
            }
            mazeElement.appendChild(cell);
        }
    }
}

// 使用广度优先搜索（BFS）找到从起点到终点的最短路径
function findShortestPath() {
    const directions = [
        { dx: 0, dy: -1 }, // 上
        { dx: 1, dy: 0 },  // 右
        { dx: 0, dy: 1 },  // 下
        { dx: -1, dy: 0 }  // 左
    ];
    
    const queue = [{ x: playerPosition.x, y: playerPosition.y, path: [] }];
    const visited = Array(size).fill(null).map(() => Array(size).fill(false));
    visited[playerPosition.y][playerPosition.x] = true;

    while (queue.length > 0) {
        const { x, y, path } = queue.shift();

        // 如果到达终点，返回路径
        if (x === goalPosition.x && y === goalPosition.y) {
            return path;
        }

        // 向四个方向移动
        for (const { dx, dy } of directions) {
            const newX = x + dx;
            const newY = y + dy;

            if (newX >= 0 && newX < size && newY >= 0 && newY < size && !visited[newY][newX] && maze[newY][newX] === 0) {
                visited[newY][newX] = true;
                queue.push({ x: newX, y: newY, path: [...path, { x: newX, y: newY }] });
            }
        }
    }

    return []; // 如果找不到路径，返回空数组
}

// 自动走迷宫功能
function autoWalk() {
    let step = 0;
    const interval = setInterval(() => {
        if (step < shortestPath.length) {
            const nextStep = shortestPath[step];
            playerPosition.x = nextStep.x;
            playerPosition.y = nextStep.y;
            renderMaze();
            step++;
        } else {
            clearInterval(interval); // 走完后停止
            alert("到达终点！");
        }
    }, 300); // 每步等待300ms
}

// 控制玩家移动
function movePlayer(dx, dy) {
    const newX = playerPosition.x + dx;
    const newY = playerPosition.y + dy;

    if (newX >= 0 && newX < size && newY >= 0 && newY < size && maze[newY][newX] === 0) {
        playerPosition.x = newX;
        playerPosition.y = newY;
        renderMaze();
        if (playerPosition.x === goalPosition.x && playerPosition.y === goalPosition.y) {
            setTimeout(() => {
                const playAgain = confirm("恭喜你！到达终点！是否重新开始？");
                if (playAgain) {
                    playerPosition.x = 0;
                    playerPosition.y = 0;
                    generateMaze(); // 重新生成迷宫
                }
            }, 100); // 100ms 延迟，防止对话框在玩家移动时打断体验
        }
    }
}

// 监听键盘事件
document.addEventListener('keydown', (event) => {
    switch (event.key) {
        case 'ArrowUp': movePlayer(0, -1); break;
        case 'ArrowDown': movePlayer(0, 1); break;
        case 'ArrowLeft': movePlayer(-1, 0); break;
        case 'ArrowRight': movePlayer(1, 0); break;
    }
});

// 初始化
generateMaze();
</script>

</body>
</html>
